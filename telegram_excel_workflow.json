{
  "name": "Telegram CSV → Excel (no DataStore)",
  "nodes": [
    {
      "id": "tg-trigger",
      "name": "Telegram Trigger",
      "type": "n8n-nodes-base.telegramTrigger",
      "typeVersion": 1,
      "position": [200, 300],
      "parameters": {
        "updates": ["message"],
        "download": true
      },
      "credentials": {
        "telegramApi": {
          "id": "__REPLACE__",
          "name": "Telegram BOT"
        }
      }
    },
    {
      "id": "csv-json",
      "name": "CSV → JSON",
      "type": "n8n-nodes-base.csvFile",
      "typeVersion": 2,
      "position": [420, 300],
      "parameters": {
        "operation": "read",
        "inputDataFieldName": "document",
        "options": {
          "header": true
        }
      }
    },
    {
      "id": "split",
      "name": "Split into Items",
      "type": "n8n-nodes-base.itemLists",
      "typeVersion": 1,
      "position": [620, 300],
      "parameters": {
        "operation": "split",
        "fieldToSplitOut": "items"
      }
    },
    {
      "id": "set-map",
      "name": "Set (map columns)",
      "type": "n8n-nodes-base.set",
      "typeVersion": 2,
      "position": [820, 300],
      "parameters": {
        "keepOnlySet": true,
        "values": {
          "string": [
            {"name": "Symbol", "value": "={{$json.Symbol || $json.symbol}}"},
            {"name": "Side", "value": "={{$json.Side || $json.side}}"},
            {"name": "Note", "value": "={{$json.Note || ''}}"},
            {"name": "UpdatedAt", "value": "={{$now}}"}
          ],
          "number": [
            {"name": "Strike", "value": "={{+$json.Strike || +$json.strike}}"},
            {"name": "Premium", "value": "={{+$json.Premium || +$json.premium}}"},
            {"name": "RiskPercent", "value": "={{+$json.RiskPercent || 0}}"},
            {"name": "RiskDollars", "value": "={{+$json.RiskDollars || 0}}"},
            {"name": "Contracts", "value": "={{+$json.Contracts || 0}}"},
            {"name": "LastClose", "value": "={{+$json.LastClose || 0}}"},
            {"name": "ATR14", "value": "={{+$json.ATR14 || 0}}"}
          ],
          "string2": [
            {"name": "Expiry", "value": "={{$json.Expiry || $json.expiry}}"},
            {"name": "EntrySignal", "value": "={{$json.EntrySignal || ''}}"},
            {"name": "SL", "value": "={{$json.SL || ''}}"},
            {"name": "TP", "value": "={{$json.TP || ''}}"}
          ]
        }
      }
    },
    {
      "id": "xlsx",
      "name": "Spreadsheet File (Write)",
      "type": "n8n-nodes-base.spreadsheetFile",
      "typeVersion": 4,
      "position": [1040, 300],
      "parameters": {
        "operation": "write",
        "options": {
          "sheetName": "RawData",
          "fileFormat": "xlsx",
          "useHeaders": true,
          "writeMode": "append"
        },
        "binaryData": false,
        "data": "={{$json}}",
        "fileName": "/data/trading_options_template.xlsx"
      }
    },
    {
      "id": "tg-send",
      "name": "Telegram → Send",
      "type": "n8n-nodes-base.telegram",
      "typeVersion": 1,
      "position": [1260, 300],
      "parameters": {
        "chatId": "={{$json.chat?.id || $json.message?.chat?.id || '__REPLACE_CHAT_ID__'}}",
        "text": "✅ تم تسجيل الصف {{ $json.Symbol || '' }} بنجاح في الإكسل."
      },
      "credentials": {
        "telegramApi": {
          "id": "__REPLACE__",
          "name": "Telegram BOT"
        }
      }
    }
  ],
  "connections": {
    "tg-trigger": { "main": [[ { "node": "csv-json", "type": "main", "index": 0 } ]] },
    "csv-json": { "main": [[ { "node": "split", "type": "main", "index": 0 } ]] },
    "split": { "main": [[ { "node": "set-map", "type": "main", "index": 0 } ]] },
    "set-map": { "main": [[ { "node": "xlsx", "type": "main", "index": 0 } ]] },
    "xlsx": { "main": [[ { "node": "tg-send", "type": "main", "index": 0 } ]] }
  }
}
